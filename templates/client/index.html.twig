{% extends 'base.html.twig' %}

{% block title %}Dashboard Client
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
	<style>
		body {
			background-color: #f5f7fa;
		}
		.table > thead {
			background-color: #0d6efd;
			color: white;
		}
		.search-container {
			background: white;
			padding: 1rem;
			border-radius: 0.5rem;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			margin-bottom: 1rem;
		}

		.btn-group .btn {
			min-width: 200px;
			text-align: left;
		}
	</style>
{% endblock %}

{% block body %}
	{% include 'layout.html.twig' %}
	<div class="container-fluid">
		<div class="row">
			<main class="col-md-12 ms-sm-auto px-md-4">
				<div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
					<h1 class="h2">Liste des Clients</h1>
					<a href="{{ path('app_client_new') }}" class="btn btn-primary">
						<i class="bi bi-plus-circle"></i>
						Nouveau client
					</a>
				</div>


				<div class="search-container mb-4">
					<form method="get" action="{{ path('app_client_index') }}" class="row g-3 align-items-end">
						<div class="col-md-4">
							<label for="commercial" class="form-label">Commercial</label>
							<select name="commercial" id="commercial" class="form-select">
								<option value="">Tous les commerciaux</option>
								{% for commercial in commerciaux %}
									<option value="{{ commercial }}" {% if app.request.query.get('commercial') == commercial %} selected {% endif %}>
										{{ commercial }}
									</option>
								{% endfor %}
							</select>
						</div>
						<div class="col-md-5">
							<label for="search" class="form-label">Recherche</label>
							<div class="input-group">
								<input type="text" name="q" id="search" class="form-control" placeholder="Nom, email ou n° contrat" value="{{ app.request.query.get('q') }}">
								<button class="btn btn-primary" type="submit">
									<i class="bi bi-search"></i>
									Appliquer
								</button>
							</div>
						</div>
						<div class="col-md-3">
							<a href="{{ path('app_client_index') }}" class="btn btn-outline-secondary w-100">
								<i class="bi bi-arrow-counterclockwise"></i>
								Réinitialiser
							</a>
						</div>
					</form>
				</div>


				<div class="card shadow-sm border-0">
					<div class="card-body p-0">
						<div class="table-responsive">
							<form method="POST" action="{{ path('app_client_bulk_actions') }}">
								<table class="table table-bordered table-hover align-middle mb-0">
									<thead>
										<tr>
											<th><input type="checkbox" id="select-all"></th>
											<th>Nom</th>
											<th>Commercial</th>
											<th>Email</th>
											<th>Cabinet</th>
											<th>N° Contrat</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for client in pagination %}
											<tr>
												<td><input type="checkbox" name="clients[]" value="{{ client.id }}"></td>
												<td>{{ client.nomClient }}</td>
												<td>{{ client.commercial }}</td>
												<td>{{ client.email }}</td>
												<td>{{ client.telephoneCabinet }}</td>
												<td>{{ client.numeroContrat }}</td>
												<td class="text-nowrap">
													<a href="{{ path('app_client_show', {id: client.id}) }}" class="btn btn-sm btn-outline-primary" title="Voir">
														<i class="bi bi-eye"></i>
													</a>
													<a href="{{ path('app_client_edit', {id: client.id}) }}" class="btn btn-sm btn-outline-warning" title="Modifier">
														<i class="bi bi-pencil"></i>
													</a>

													<!-- Bouton suppression ouvre modal -->
													<button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ client.id }}" title="Supprimer">
														<i class="bi bi-trash"></i>
													</button>

													<!-- Modal suppression -->
													<div class="modal fade" id="deleteModal{{ client.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ client.id }}" aria-hidden="true">
														<div class="modal-dialog modal-dialog-centered">
															<div class="modal-content">
																<div class="modal-header bg-danger text-white">
																	<h5 class="modal-title" id="deleteModalLabel{{ client.id }}">Confirmer la suppression</h5>
																	<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
																</div>
																<div class="modal-body">
																	Êtes-vous sûr de vouloir supprimer le client
																	<br>
																	<strong>{{ client.nomClient }}</strong>
																	?
																	<br>
																	Cette action est irréversible.
																</div>
																<div class="modal-footer">
																	<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
																	<form method="post" action="{{ path('app_client_delete', {'id': client.id}) }}" style="display:inline-block;">
																		<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ client.id) }}">
																		<button type="submit" class="btn btn-danger">Supprimer</button>
																	</form>
																</div>
															</div>
														</div>
													</div>
												</td>

											</tr>
										{% else %}
											<tr>
												<td colspan="6" class="text-center">Aucun client trouvé</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
								<div class="d-flex justify-content-between align-items-center p-3 border-top">
									<div class="col-md-6">
										<label class="form-label d-block">Appliquer les actions suivantes :</label>
										<div class="btn-group" role="group" aria-label="Actions à appliquer">
											{% for action in all_actions %}
												<input type="checkbox" class="btn-check" id="action_{{ action.id }}" name="actions[]" value="{{ action.id }}" autocomplete="off">
												<label class="btn btn-outline-primary m-1" for="action_{{ action.id }}">{{ action.label }}</label>
											{% endfor %}
										</div>
									</div>
									<div class="col-md-3">
										<button type="submit" class="btn btn-success mt-3 w-100">
											<i class="bi bi-check-circle"></i>
											Appliquer aux clients sélectionnés
										</button>
									</div>
								</div>
							</form>
						</div>

						<div class="d-flex justify-content-center mt-4">
							{{ knp_pagination_render(pagination) }}
						</div>
					</div>
				</div>
			</main>
		</div>
	</div>
{% endblock %}

{% block javascripts %} <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	 <script>
			    document.getElementById('select-all')?.addEventListener('change', function () {
			        const checkboxes = document.querySelectorAll('input[name="clients[]"]');
			        checkboxes.forEach(cb => cb.checked = this.checked);
			    });
			</script>
{% endblock %}
